<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Red Herring Civil Rights Intake</title>

<style>
body {
  background: #0a0a0a;
  color: #fff;
  font-family: Arial, sans-serif;
  margin: 0;
  padding: 0;
}

.header {
  padding: 20px;
  text-align: center;
  background: #111;
  border-bottom: 2px solid #b30000;
}

#chat-container {
  width: 90%;
  max-width: 600px;
  background: #111;
  margin: 30px auto;
  border: 1px solid #b30000;
  border-radius: 8px;
  padding: 15px;
}

.message {
  padding: 10px;
  margin-bottom: 10px;
  border-radius: 6px;
  line-height: 1.4;
}

.bot {
  background: #1a1a1a;
  border-left: 4px solid #b30000;
}

.user {
  background: #222;
  border-right: 4px solid #555;
  text-align: right;
}

.controls {
  display: flex;
  gap: 10px;
  margin-bottom: 15px;
  margin-top: 10px;
}

.controls button {
  flex: 1;
  padding: 10px;
  border: none;
  border-radius: 6px;
  background: #b30000;
  color: #fff;
  font-weight: bold;
  cursor: pointer;
}

#input-area {
  display: flex;
  gap: 10px;
}

#user-input {
  flex: 1;
  padding: 10px;
  border-radius: 6px;
  border: none;
}

#send-btn {
  background: #b30000;
  color: #fff;
  padding: 10px 15px;
  border: none;
  border-radius: 6px;
  cursor: pointer;
}

#floating-help {
  position: fixed;
  bottom: 20px;
  right: 20px;
  background: #b30000;
  padding: 12px;
  border-radius: 50%;
  font-size: 18px;
  cursor: pointer;
}
</style>
</head>

<body>

<div class="header">
  <h2>Helyah â€“ Civil Rights Intake Assistant</h2>
</div>

<div id="chat-container"></div>

<div id="controls" class="controls">
  <button id="read-btn">ðŸ”Š Read</button>
  <button id="speak-btn">ðŸŽ™ Speak</button>
  <button id="voice-mode-btn">ðŸŽ§ Voice Mode: OFF</button>
</div>

<div id="input-area">
  <input type="text" id="user-input" placeholder="Type your response..." />
  <button id="send-btn">Send</button>
</div>

<div id="floating-help">ðŸ’¬</div>

<script>
// ---------------------------------------------
// ANDROID AUDIO UNLOCK PATCH
// ---------------------------------------------
let unlocked = false;
function unlockAudio() {
  if (!unlocked) {
    const ctx = new AudioContext();
    const source = ctx.createBufferSource();
    source.buffer = ctx.createBuffer(1, 1, 22050);
    source.connect(ctx.destination);
    source.start(0);
    unlocked = true;
  }
}
document.body.addEventListener("click", unlockAudio);
document.body.addEventListener("touchstart", unlockAudio);

// ---------------------------------------------
// TEXT-TO-SPEECH ENGINE
// ---------------------------------------------
function speakText(message) {
  unlockAudio();
  window.speechSynthesis.cancel();

  const utter = new SpeechSynthesisUtterance(message);
  utter.pitch = 1;
  utter.rate = 1;
  utter.volume = 1;

  // force voice list load
  window.speechSynthesis.getVoices();

  setTimeout(() => {
    window.speechSynthesis.speak(utter);
  }, 100);
}

// ---------------------------------------------
// SPEECH RECOGNITION ENGINE
// ---------------------------------------------
let recognition;
try {
  const SpeechRecognition =
    window.SpeechRecognition || window.webkitSpeechRecognition;
  recognition = new SpeechRecognition();
  recognition.lang = "en-US";
  recognition.interimResults = false;
} catch (e) {
  console.log("Speech recognition not supported.");
}

// ---------------------------------------------
// CHAT SYSTEM
// ---------------------------------------------
const chat = document.getElementById("chat-container");

function addMessage(text, sender) {
  const div = document.createElement("div");
  div.className = `message ${sender}`;
  div.textContent = text;
  chat.appendChild(div);
  chat.scrollTop = chat.scrollHeight;
}

addMessage(
  "Welcome. I am Helyah, the civil-rights intake assistant. I will guide you through a formal 18 USC 242 complaint.",
  "bot"
);

// ---------------------------------------------
// BUTTON LISTENERS
// ---------------------------------------------
document.getElementById("read-btn").addEventListener("click", () => {
  const last = chat.lastChild?.textContent || "";
  speakText(last);
});

document.getElementById("speak-btn").addEventListener("click", () => {
  if (!recognition) return alert("Voice input not supported.");

  recognition.start();

  recognition.onresult = (event) => {
    const text = event.results[0][0].transcript;
    document.getElementById("user-input").value = text;
  };
});

// ---------------------------------------------
// VOICE MODE
// ---------------------------------------------
let voiceMode = false;
document.getElementById("voice-mode-btn").addEventListener("click", () => {
  voiceMode = !voiceMode;
  document.getElementById("voice-mode-btn").textContent =
    voiceMode ? "ðŸŽ§ Voice Mode: ON" : "ðŸŽ§ Voice Mode: OFF";

  if (voiceMode) {
    const last = chat.lastChild?.textContent || "";
    speakText(last);
  }
});

// ---------------------------------------------
// SEND MESSAGE
// ---------------------------------------------
document.getElementById("send-btn").addEventListener("click", sendMessage);

function sendMessage() {
  const text = document.getElementById("user-input").value.trim();
  if (!text) return;

  addMessage(text, "user");
  document.getElementById("user-input").value = "";

  // Helyah responds
  setTimeout(() => {
    const reply =
      "Thank you. Please continue. I will compile your responses into a formal civil-rights complaint.";
    addMessage(reply, "bot");

    if (voiceMode) speakText(reply);
  }, 500);
}
</script>

</body>
</html>
